using Localization;
using System;
using System.Linq;
using System.Windows.Forms;

namespace BOSERP.Modules.HRDepartment
{
    #region HRDepartmentModule
    //-----------------------------------------------------------
    //Generated By: BOS Studio
    //Class:DepartmentModule
    //Created Date:Thursday, February 17, 2011
    //-----------------------------------------------------------

    public class HRDepartmentModule : BaseModuleERP
    {
        public HRDepartmentModule()
        {
            Name = "HRDepartment";
            CurrentModuleEntity = new HRDepartmentEntities();
            CurrentModuleEntity.Module = this;
            InitializeModule();
        }

        /// <summary>
        /// Remove an item from the room list of the current department
        /// </summary>
        public void RemoveItemFromList()
        {
            HRDepartmentEntities entity = (HRDepartmentEntities)CurrentModuleEntity;
            entity.DepartmentRoomList.RemoveSelectedRowObjectFromList();
        }

        public void ChangeDepartmentRoomBoundary()
        {
            HRDepartmentEntities entity = (HRDepartmentEntities)CurrentModuleEntity;
            HRDepartmentsInfo mainObject = (HRDepartmentsInfo)entity.MainObject;
            mainObject.HRDepartmentTotalEmployee = (decimal)entity.DepartmentRoomList.Sum(o => o.HRDepartmentRoomBoundary);
            entity.UpdateMainObjectBindingSource();
        }

        public override int ActionSave()
        {
            HRDepartmentEntities entity = (HRDepartmentEntities)CurrentModuleEntity;
            HRDepartmentsInfo mainObject = (HRDepartmentsInfo)entity.MainObject;
            foreach (HRDepartmentRoomsInfo item in entity.DepartmentRoomList)
            {
                if (checkExistDepartmentRoomNo(item))
                {
                    MessageBox.Show("Mã bộ phận: " + item.HRDepartmentRoomNo + "; Tên bộ phận: " + item.HRDepartmentRoomName + " không được trùng. Vui lòng kiểm tra lại!", CommonLocalizedResources.MessageBoxDefaultCaption, MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return 0;
                }
            }
            return base.ActionSave();
        }

        public bool checkExistDepartmentRoomNo(HRDepartmentRoomsInfo objDepartmentRoomsInfo)
        {
            HRDepartmentEntities entity = (HRDepartmentEntities)CurrentModuleEntity;
            int check = 0;
            foreach (HRDepartmentRoomsInfo item in entity.DepartmentRoomList)
            {
                if (!String.IsNullOrEmpty(item.HRDepartmentRoomNo))
                {
                    if (item.HRDepartmentRoomNo.Trim() == objDepartmentRoomsInfo.HRDepartmentRoomNo.Trim() || item.HRDepartmentRoomName.Trim() == objDepartmentRoomsInfo.HRDepartmentRoomName.Trim())
                    {
                        check++;
                    }
                }
            }
            if (check > 1)
                return true;
            return false;
        }
    }
    #endregion
}
