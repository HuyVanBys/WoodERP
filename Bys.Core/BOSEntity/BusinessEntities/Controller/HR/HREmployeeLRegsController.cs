using BOSLib;
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;


namespace BOSERP
{
    #region HREmployeeLRegs
    //-----------------------------------------------------------
    //Generated By: BOS Studio
    //Class:HREmployeeLRegsController
    //Created Date:Thursday, May 23, 2019
    //-----------------------------------------------------------

    public class HREmployeeLRegsController : BaseBusinessController
    {
        public HREmployeeLRegsController()
        {
            dal = new DALBaseProvider("HREmployeeLRegs", typeof(HREmployeeLRegsInfo));
        }

        public List<HREmployeeLRegsInfo> GetAllEmployeeLRegs()
        {
            DataSet ds = dal.GetDataSet("HREmployeeLRegs_SelectAll");
            List<HREmployeeLRegsInfo> lst = new List<HREmployeeLRegsInfo>();
            if (ds.Tables.Count > 0)
            {
                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    HREmployeeLRegsInfo obj = (HREmployeeLRegsInfo)GetObjectFromDataRow(row);
                    lst.Add(obj);
                }
            }
            ds.Dispose();
            return lst;
        }

        public DataSet GetEmployeeLRegByYear(int iYear)
        {
            String strQuery = String.Format("SELECT a.*, b.HREmployeeName, b.HREmployeeStartWorkingDate FROM [dbo].[HREmployeeLRegs] a LEFT JOIN   dbo.HREmployees b ON a.FK_HREmployeeID = b.HREmployeeID  WHERE [HREmployeeLRegYear]={0} AND a.[AAStatus]='{1}' AND b.[AAStatus]='{1}' AND [FK_HREmployeeID] IN (SELECT HREmployeeID FROM [dbo].[HREmployees] WHERE [AAStatus]='{1}')", iYear, BusinessObject.DefaultAAStatus);
            return dal.GetDataSet(strQuery);
        }

        public DataSet DeleteAllEmployeeLRegByYear(int iYear)
        {
            String strQuery = String.Format(@"UPDATE dbo.HREmployeeLRegs SET AAStatus='Delete' WHERE HREmployeeLRegYear={0}", iYear);
            return dal.GetDataSet(strQuery);
        }

        public HREmployeeLRegsInfo GetEmployeeLRegByEmployeeIDAndYear(int iEmployeeID, int iYear)
        {
            String strQuery = String.Format("SELECT * FROM [dbo].[HREmployeeLRegs]WHERE [HREmployeeLRegYear]={0} AND [AAStatus]='{1}' AND [FK_HREmployeeID] =(SELECT HREmployeeID FROM [dbo].[HREmployees] WHERE [AAStatus]='{1}'AND [HREmployeeID]={2} )", iYear, BusinessObject.DefaultAAStatus, iEmployeeID);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HREmployeeLRegsInfo objHREmployeeLRegsInfo = (HREmployeeLRegsInfo)dal.GetObjectFromDataRow(row);
                        return objHREmployeeLRegsInfo;
                    }

                }
            }
            return null;
        }

        public HREmployeeLRegsInfo GetmaxYearCal()
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.HREmployeeLRegs
						                        WHERE HREmployeeLRegDateCal=(SELECT MAX(HREmployeeLRegDateCal) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive') AND AAStatus='Alive'");
            DataSet ds = dal.GetDataSet(strQuery);
            List<HREmployeeLRegsInfo> lstEmployeeLRegs = (List<HREmployeeLRegsInfo>)GetListFromDataSet(ds);
            if (lstEmployeeLRegs != null)
                return lstEmployeeLRegs.FirstOrDefault();
            return null;

        }

        public override System.Collections.IList GetListFromDataSet(DataSet ds)
        {
            List<HREmployeeLRegsInfo> lst = new List<HREmployeeLRegsInfo>();
            if (ds.Tables.Count > 0)
            {
                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    HREmployeeLRegsInfo obj = (HREmployeeLRegsInfo)GetObjectFromDataRow(row);
                    lst.Add(obj);
                }
            }
            ds.Dispose();
            return lst;
        }
    }
    #endregion
}