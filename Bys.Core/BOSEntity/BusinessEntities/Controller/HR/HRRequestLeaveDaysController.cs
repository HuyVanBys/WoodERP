using BOSLib;
using System;
using System.Collections.Generic;
using System.Data;


namespace BOSERP
{
    #region HRRequestLeaveDays
    //-----------------------------------------------------------
    //Generated By: BOS Studio
    //Class:HRRequestLeaveDaysController
    //Created Date:Tuesday, February 12, 2019
    //-----------------------------------------------------------

    public class HRRequestLeaveDaysController : BaseBusinessController
    {
        public HRRequestLeaveDaysController()
        {
            dal = new DALBaseProvider("HRRequestLeaveDays", typeof(HRRequestLeaveDaysInfo));
        }

        public override System.Collections.IList GetListFromDataSet(DataSet ds)
        {
            List<HRRequestLeaveDaysInfo> leaveDays = new List<HRRequestLeaveDaysInfo>();
            if (ds.Tables.Count > 0)
            {
                foreach (DataRow row in ds.Tables[0].Rows)
                {
                    HRRequestLeaveDaysInfo leaveDay = (HRRequestLeaveDaysInfo)GetObjectFromDataRow(row);
                    leaveDays.Add(leaveDay);
                }
            }
            return leaveDays;
        }

        public DataSet GetLeaveApplicationListDatasetByListOfBranchID(string leaveApplicationNo,
                                                                string leaveApplicationName,
                                                                DateTime? fromDate,
                                                                DateTime? toDate,
                                                                List<BRBranchsInfo> branchList)
        {
            DataSet rtn = new DataSet();
            foreach (BRBranchsInfo ojbBranchsInfo in branchList)
            {
                DataSet ds = GetLeaveApplicationListDataset(leaveApplicationNo,
                                                        leaveApplicationName,
                                                        fromDate,
                                                        toDate,
                                                        ojbBranchsInfo.BRBranchID);
                rtn.Merge(ds);
            }

            return rtn;
        }

        public DataSet GetLeaveApplicationListDataset(string leaveApplicationNo, string leaveApplicationName, DateTime? fromDate, DateTime? toDate, int brandID)
        {
            return dal.GetDataSet("HRRequestLeaveDays_GetLeaveApplicationListDataset", leaveApplicationNo, leaveApplicationName, fromDate, toDate, brandID);
        }

        public List<HRRequestLeaveDaysInfo> ShowAllLeaveApplicationForHome(DateTime fromDate, DateTime toDate)
        {
            DataSet ds = dal.GetDataSet("HRRequestLeaveDays_ShowAllLeaveApplicationForHome", fromDate, toDate);
            return (List<HRRequestLeaveDaysInfo>)GetListFromDataSet(ds);
        }

        public DataSet GetAllDataByEmployeeLeaveFromToByLeaveType(int iEmployeeID, DateTime dtFrom, DateTime dtTo, string strTimeSheetParamType)
        {
            String str = String.Format(@"   SELECT * FROM dbo.HRRequestLeaveDays 
                                             JOIN dbo.HRTimeSheetParams ON 
		                                     (HRTimeSheetParams.HRTimeSheetParamID = HRRequestLeaveDays.FK_HRTimeSheetParamID AND HRRequestLeaveDays.AAStatus = HRTimeSheetParams.AAStatus)
                                            WHERE HRTimeSheetParams.AAStatus='Alive' AND HRTimeSheetParams.HRTimeSheetParamType='{3}'
                                            AND (FK_HREmployeeID={0} OR {0} = 0)
                                            AND 
                                            (
                                                (
                                                    CONVERT(VARCHAR(10),HRRequestLeaveDayFromDate, 112) >= CONVERT(VARCHAR(10),'{1}', 112)
	                                                AND
	                                                CONVERT(VARCHAR(10),HRRequestLeaveDayFromDate, 112) <= CONVERT(VARCHAR(10),'{2}', 112)
                                                )
                                                OR 
                                                (
	                                                CONVERT(VARCHAR(10),HRRequestLeaveDayFromDate, 112) < CONVERT(VARCHAR(10),'{1}', 112)
	                                                AND 
	                                                CONVERT(VARCHAR(10),HRRequestLeaveDayToDate, 112) >= CONVERT(VARCHAR(10),'{1}', 112)
	                                                AND
	                                                CONVERT(VARCHAR(10),HRRequestLeaveDayToDate, 112) <= CONVERT(VARCHAR(10),'{2}', 112)
                                                )
                                            )
                                        ", iEmployeeID, dtFrom.ToString("yyyyMMdd"), dtTo.ToString("yyyyMMdd"), strTimeSheetParamType);
            return dal.GetDataSet(str);
        }
    }
    #endregion
}